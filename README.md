# ğŸµ 2FMusic

> è¿™æ˜¯ä¸€ä¸ªè½»é‡çš„æœ¬åœ°éŸ³ä¹æ’­æ”¾å™¨ï¼ŒåŸºäº Flask + åŸç”Ÿ Web æŠ€æœ¯æ„å»ºã€‚

**ç›®å‰é¡¹ç›®å¤„äºæ—©æœŸå¼€å‘é˜¶æ®µï¼ŒåŠŸèƒ½æš‚ä¸ç¨³å®šï¼Œæ¬¢è¿æäº¤ PR å®Œå–„é¡¹ç›® æˆ– Issue åé¦ˆ Bugï¼**

---

## æ ¸å¿ƒåŠŸèƒ½

*   **ğŸ§ æœ¬åœ°éŸ³ä¹åº“**
    *   è‡ªåŠ¨æ‰«æå¹¶ç®¡ç†ä¸Šä¼ çš„éŸ³ä¹æ–‡ä»¶ã€‚
    *   æ”¯æŒè¯†åˆ« ID3 å†…åµŒå…ƒæ•°æ®ï¼ˆå°é¢ã€æ­Œè¯ï¼‰ã€‚
    *   æ”¯æŒé€šè¿‡ ç½‘ç»œæº è‡ªåŠ¨è·å–å°é¢ã€æ­Œè¯ã€‚
*   **ğŸ“± æ²‰æµ¸å¼æ’­æ”¾å™¨**
    *   **å“åº”å¼ UI**ï¼šPC Webç«¯ æä¾›åŸç”Ÿ App èˆ¬çš„æµç•…ä½“éªŒã€‚
    *   **åŠ¨æ€è§†è§‰**ï¼šæ”¯æŒæ­Œè¯æ»šåŠ¨æ˜¾ç¤ºã€æ ¹æ®å°é¢è‡ªåŠ¨æå–ä¸»é¢˜è‰²ã€‚
*   **ğŸ“‚ çµæ´»ç›®å½•ç®¡ç†**
    *   æ”¯æŒæ·»åŠ æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶å¤¹åˆ°éŸ³ä¹åº“ï¼Œæ— éœ€é‡å¤ç§»åŠ¨æ–‡ä»¶ã€‚
*   **â˜ï¸ ç½‘æ˜“äº‘éŸ³ä¹é›†æˆ**
    *   é›†æˆæœç´¢ã€é«˜å“è´¨ä¸‹è½½åŠŸèƒ½ã€‚
    *   æ”¯æŒé“¾æ¥è§£æåŠæ‰«ç ç™»å½•ï¼Œè½»æ¾åŒæ­¥æ­Œå•ã€‚
*   **ğŸ”Š éŸ³é¢‘é¢„è§ˆ**
    *   æ”¯æŒå³é”®å¿«é€Ÿé¢„è§ˆæ’­æ”¾éŸ³é¢‘æ–‡ä»¶ï¼ˆéœ€å®‰è£… 2FMusic Preview æ‰©å±•ï¼‰ã€‚

## ç›´æ¥å¯åŠ¨

```bash
python server/app.py --music-library-path ./Music --log-path ./app.log --port 23237
```

å‚æ•°ï¼š
- `--music-library-path`: éŸ³ä¹æ–‡ä»¶å­˜å‚¨ç›®å½•
- `--log-path`: æ—¥å¿—æ–‡ä»¶è·¯å¾„
- `--port`: æœåŠ¡ç«¯å£ (é»˜è®¤ 23237)
- `--password`: è®¾ç½®è®¿é—®å¯†ç 

## ğŸ› ï¸ å¼€æºè‡´è°¢

æœ¬é¡¹ç›®ä½¿ç”¨äº†ä»¥ä¸‹ä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼š

*   **UI å›¾æ ‡**: [Font Awesome](https://fontawesome.com/) (CC BY 4.0 / OFL)
*   **è‰²å½©ç®—æ³•**: [ColorThief](https://lokeshdhakar.com/projects/color-thief/) (MIT)
*   **æ­Œè¯/å°é¢ API**: [LrcApi](https://github.com/HisAtri/LrcApi) (GPL-3.0)
*   **ç½‘æ˜“äº‘ API**: [NeteaseCloudMusicApiEnhanced](https://github.com/NeteaseCloudMusicApiEnhanced/api-enhanced) (MIT)

---

## ğŸ“– åç«¯ API æ‰‹å†Œ

åç«¯åŸºäº Flask æ„å»ºï¼Œé»˜è®¤ç«¯å£ä¸º `23237`ã€‚

### ğŸ†” æœ¯è¯­ä¸ ID å®šä¹‰

åœ¨è°ƒç”¨ API å‰ï¼Œè¯·äº†è§£ä»¥ä¸‹ ID çš„å®šä¹‰ä¸æ¥æºï¼š

| ID åç§° | å˜é‡å | ç”Ÿæˆé€»è¾‘ / æ¥æº |
| :--- | :--- | :--- |
| **æ­Œæ›² ID** | `song_id` | æœåŠ¡å™¨ç”Ÿæˆçš„ MD5 å“ˆå¸Œå€¼ã€‚ç®—æ³•ï¼š`MD5(æ–‡ä»¶ç»å¯¹è·¯å¾„)`ã€‚ç”¨äºå”¯ä¸€æ ‡è¯†åº“å†…éŸ³é¢‘ã€‚ |
| **æ”¶è—å¤¹ ID**| `playlist_id` | ç”¨æˆ·åˆ›å»ºæ—¶ç”Ÿæˆï¼ˆ`æ—¶é—´æˆ³ + éšæœºç `ï¼‰ã€‚ç³»ç»Ÿé»˜è®¤æ”¶è—å¤¹ ID ä¸º `default`ã€‚ |
| **ç½‘æ˜“äº‘ ID**| `netease_id` | ç½‘æ˜“äº‘éŸ³ä¹å¹³å°çš„åŸç”Ÿæ•°å­— IDã€‚é€šè¿‡æœã€é“¾æ¥è§£æè·å–ã€‚ |
| **ä»»åŠ¡ ID** | `task_id` | å¼‚æ­¥ä¸‹è½½ä»»åŠ¡çš„è¿½è¸ª IDã€‚ç”± `task_æ—¶é—´æˆ³_éšæœºç ` ç»„æˆã€‚ |

> [!NOTE]
> æ‰€æœ‰ API å“åº”ï¼ˆé™¤æµå¼æ’­æ”¾æ¥å£å¤–ï¼‰å‡ä¸ºæ ‡å‡† JSON æ ¼å¼ã€‚

### 1. ç³»ç»Ÿä¸éªŒè¯ (System & Auth)

| æ–¹æ³• | è·¯å¾„ | å‚æ•°è¯´æ˜ | åŠŸèƒ½æè¿° |
| :--- | :--- | :--- | :--- |
| `GET` | `/api/version_check` | `force_refresh` (Query, å¯é€‰): æ˜¯å¦å¼ºåˆ¶åˆ·æ–° MD5 ç¼“å­˜ | è·å–ç³»ç»Ÿç‰ˆæœ¬ï¼ˆåŸºäºé™æ€æ–‡ä»¶ MD5ï¼‰ |
| `GET` | `/api/system/status` | - | è·å–åº“æ‰«æã€å…ƒæ•°æ®åˆ®å‰Šè¿›åº¦åŠåº“ç‰ˆæœ¬ |
| `GET` | `/api/clear-version-cache` | - | æ¸…é™¤ç³»ç»Ÿç‰ˆæœ¬ç¼“å­˜ |
| `POST` | `/login` | `password` (Form, å¿…é€‰), `remember` (Form, å¯é€‰), `next` (Query, å¯é€‰) | ç™»å½•ï¼ˆæ”¯æŒæ˜æ–‡æˆ– SHA256ï¼‰ |
| `GET` | `/logout` | - | ç™»å‡ºå¹¶æ¸…ç† Session |

### 2. éŸ³ä¹åº“ç®¡ç† (Music Library)

| æ–¹æ³• | è·¯å¾„ | å‚æ•°è¯´æ˜ | åŠŸèƒ½æè¿° |
| :--- | :--- | :--- | :--- |
| `GET` | `/api/music` | - | è·å–åº“å†…æ‰€æœ‰éŸ³ä¹åˆ—è¡¨ï¼ˆåŒ…å«å…ƒæ•°æ®ä¸å°é¢é“¾æ¥ï¼‰ |
| `GET` | `/api/music/play/<id>` | `id` (Path): æ­Œæ›² ID | æ’­æ”¾/æµå¼ä¼ è¾“éŸ³ä¹æ–‡ä»¶ï¼ˆæ”¯æŒ Range æ±‚ï¼‰ |
| `GET` | `/api/music/lyrics` | `title` (Query, å¿…é€‰), `artist`, `filename` | è·å–æ­Œè¯ (æœ¬åœ° `lrc` -> å†…åµŒ -> ç½‘ç»œèšåˆ) |
| `GET` | `/api/music/album-art` | `title` (Query, å¿…é€‰), `artist`, `filename` | è·å–ä¸“è¾‘å°é¢é“¾æ¥ |
| `DELETE` | `/api/music/delete/<id>` | `id` (Path): æ­Œæ›² ID | **ç‰©ç†åˆ é™¤**åº“å†…éŸ³é¢‘æ–‡ä»¶åŠå…¶å…³è”èµ„æº |
| `POST` | `/api/music/upload` | `file` (Form-Data, å¿…é€‰), `target_dir` (Form, å¯é€‰) | ä¸Šä¼ éŸ³ä¹åˆ°æŒ‡å®šç›®å½•ï¼ˆéœ€åœ¨ç®¡ç†ç›®å½•å†…ï¼‰ |
| `POST` | `/api/music/import_path` | `path` (JSON, å¿…é€‰): æœåŠ¡å™¨ç‰©ç†è·¯å¾„ | å°†æœåŠ¡å™¨ä¸Šçš„å•ä¸ªæ–‡ä»¶å¯¼å…¥ä¸»éŸ³ä¹åº“ |
| `POST` | `/api/music/clear_metadata`| `path` (JSON) æˆ– `id` (Path) | æ¸…é™¤æŒ‡å®šæ­Œæ›²çš„æœ¬åœ°ç¼“å­˜å°é¢å’Œæ­Œè¯ |

### 3. ç›®å½•ç®¡ç† (Mount Points)

| æ–¹æ³• | è·¯å¾„ | å‚æ•°è¯´æ˜ | åŠŸèƒ½æè¿° |
| :--- | :--- | :--- | :--- |
| `GET` | `/api/mount_points` | - | åˆ—å‡ºæ‰€æœ‰å·²æ·»åŠ çš„å¤–éƒ¨éŸ³é¢‘æ–‡ä»¶å¤¹ |
| `POST` | `/api/mount_points` | `path` (JSON, å¿…é€‰): ç»å¯¹è·¯å¾„ | æ·»åŠ æ–°çš„æŒ‚è½½ç›®å½•å¹¶è‡ªåŠ¨è§¦å‘åå°æ‰«æ |
| `DELETE` | `/api/mount_points` | `path` (JSON, å¿…é€‰): ç»å¯¹è·¯å¾„ | ç§»é™¤æŒ‚è½½ç›®å½•å¹¶ä»åº“ä¸­æ¸…ç†ç›¸å…³æ­Œæ›²è®°å½• |
| `POST` | `/api/mount_points/update` | `path` (JSON, å¿…é€‰) | æ‰‹åŠ¨è§¦å‘æŒ‡å®šæŒ‚è½½ç›®å½•çš„å¢é‡æ‰«æ |
| `POST` | `/api/mount_points/retry_scrape` | `path` (JSON, å¿…é€‰) | å¯¹æŒ‡å®šç›®å½•ä¸­ç¼ºå¤±å°é¢çš„æ­Œæ›²é‡æ–°åˆ®å‰Š |

### 4. æ”¶è—å¤¹ (Favorites)

| æ–¹æ³• | è·¯å¾„ | å‚æ•°è¯´æ˜ | åŠŸèƒ½æè¿° |
| :--- | :--- | :--- | :--- |
| `GET` | `/api/favorite_playlists` | - | è·å–æ‰€æœ‰æ”¶è—å¤¹ï¼ˆåç§°ã€åˆ›å»ºæ—¶é—´ã€æ­Œæ›²æ•°ï¼‰ |
| `POST` | `/api/favorite_playlists` | `name` (JSON, å¿…é€‰): æ”¶è—å¤¹åç§° | åˆ›å»ºæ–°çš„ä¸ªäººæ”¶è—å¤¹ |
| `DELETE` | `/api/favorite_playlists/<id>`| `id` (Path): æ”¶è—å¤¹ ID | åˆ é™¤æ”¶è—å¤¹ï¼ˆé»˜è®¤æ”¶è—å¤¹ç¦æ­¢åˆ é™¤ï¼‰ |
| `GET` | `/api/favorite_playlists/<id>/songs` | `id` (Path): æ”¶è—å¤¹ ID | è·å–æ”¶è—å¤¹å†…æ‰€æœ‰æ­Œæ›²çš„ `song_id` åˆ—è¡¨ |
| `POST` | `/api/favorites` | `song_id` (JSON, å¿…é€‰), `playlist_id` (JSON, é€‰) | å°†æ­Œæ›²æ·»åŠ è‡³æŒ‡å®šæ”¶è—å¤¹ï¼ˆé»˜è®¤ä¸º `default`ï¼‰ |
| `DELETE` | `/api/favorites` | `song_id` (JSON, å¿…é€‰), `playlist_id` (JSON, é€‰) | ä»æŒ‡å®šæ”¶è—å¤¹ç§»é™¤æ­Œæ›² |
| `POST` | `/api/favorites/batch` | `song_ids` (Array), `playlist_ids` (Array) | æ‰¹é‡è·¨æ”¶è—å¤¹æ·»åŠ æ­Œæ›² |
| `POST` | `/api/favorites/batch/move` | `song_ids`, `from_playlist_id`, `to_playlist_id` | æ‰¹é‡å°†æ­Œæ›²ä»ä¸€ä¸ªæ”¶è—å¤¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ª |

### 5. ç½‘æ˜“äº‘é›†æˆ (NetEase Integration)

| ç±»åˆ« | æ–¹æ³• | è·¯å¾„ | å‚æ•°è¯´æ˜ | åŠŸèƒ½æè¿° |
| :--- | :--- | :--- | :--- | :--- |
| **æœç´¢** | `GET` | `/api/netease/search` | `keywords` (å¿…é€‰), `limit` (é»˜è®¤20) | åœ¨çº¿æœç´¢ç½‘æ˜“äº‘éŸ³ä¹æ›²åº“ |
| | `GET` | `/api/netease/recommend` | - | è·å–ç™»å½•è´¦å·çš„æ¯æ—¥æ¨èæ­Œæ›² |
| **è§£æ** | `GET` | `/api/netease/resolve` | `input` / `link`: åˆ†äº«é“¾æ¥æˆ– ID | æ™ºèƒ½è¯†åˆ«å¹¶è§£æç½‘æ˜“äº‘é“¾æ¥ï¼ˆæ”¯æŒçŸ­é“¾ï¼‰ |
| | `GET` | `/api/netease/playlist` | `id` / `link`: æ­Œå• ID æˆ–é“¾æ¥ | è·å–ç½‘æ˜“äº‘æ­Œå•è¯¦ç»†æ­Œæ›²åˆ—è¡¨ |
| **ç™»å½•** | `GET` | `/api/netease/login/qrcode` | - | ç”Ÿæˆç½‘æ˜“äº‘æ‰«ç ç™»å½•äºŒç»´ç  |
| | `GET` | `/api/netease/login/check` | `key` (Query, å¿…é€‰): äºŒç»´ç  Key | è½®è¯¢æ‰«ç ç™»å½•çŠ¶æ€ï¼ŒæˆåŠŸåè‡ªåŠ¨å­˜å…¥ Cookie |
| **ä¸‹è½½** | `POST` | `/api/netease/download` | `id` (å¿…é€‰), `level` (éŸ³è´¨), `target_dir` | å‘èµ·å¼‚æ­¥ä¸‹è½½ä»»åŠ¡ï¼ˆæ”¯æŒå†…åµŒå…ƒæ•°æ®å’Œå°é¢ï¼‰ |
| | `GET` | `/api/netease/task/<id>` | `id` (Path): ä»»åŠ¡ ID | æŸ¥è¯¢å½“å‰ä¸‹è½½ä»»åŠ¡çš„çŠ¶æ€ã€è¿›åº¦åŠé”™è¯¯ä¿¡æ¯ |
| **è¿ç»´** | `POST` | `/api/netease/install_service` | - | è‡ªåŠ¨æ‹‰å–å¹¶è¿è¡Œ Docker å®¹å™¨åŒ–çš„ NCM-API |
| | `GET/POST`| `/api/netease/config` | `download_dir`, `api_base` | é…ç½®ä¸‹è½½è·¯å¾„åŠ API æœåŠ¡åœ°å€ |

> [!TIP]
> **ä¸‹è½½éŸ³è´¨ (`level`)**ï¼šæ”¯æŒ `standard`, `higher`, `exhigh` (é»˜è®¤), `lossless`, `hires`ã€‚

### 6. å¤–éƒ¨æ–‡ä»¶é¢„è§ˆ (External Files)

æ­¤ç±»æ¥å£ä¸“ä¸ºç½‘é¡µæ‰©å±•æˆ–ç›´æ¥è·¯å¾„è®¿é—®è®¾è®¡ï¼Œä¸è¦æ±‚æ–‡ä»¶åœ¨éŸ³ä¹åº“å†…ã€‚

| æ–¹æ³• | è·¯å¾„ | å‚æ•°è¯´æ˜ | åŠŸèƒ½æè¿° |
| :--- | :--- | :--- | :--- |
| `GET` | `/api/music/external/meta` | `path` (Query, å¿…é€‰): æœåŠ¡å™¨ç‰©ç†è·¯å¾„ | å®æ—¶æå–åº“å¤–éŸ³é¢‘æ–‡ä»¶çš„å…ƒä¿¡æ¯ä¸å°é¢ç¼“å­˜ |
| `GET` | `/api/music/external/play` | `path` (Query, å¿…é€‰): æœåŠ¡å™¨ç‰©ç†è·¯å¾„ | ç›´æ¥æ’­æ”¾æœåŠ¡å™¨ä¸Šçš„ä»»æ„éŸ³é¢‘æ–‡ä»¶ |
