#!/bin/bash

APP_NAME="2FMusic Preview"
LOG_FILE="${TRIM_PKGVAR}/info.log"

# 启动应用（纯 CGI 模式）
start_process() {
    log_msg "正在启动 ${APP_NAME}（纯 CGI 模式）..."
    
    # 纯 CGI 应用不需要启动进程
    # 只需要重载 HTTP CGI 服务，让 Web 服务器识别 CGI 脚本
    log_msg "重载 HTTP CGI 服务..."
    systemctl restart trim_http_cgi.service >> ${LOG_FILE} 2>&1
    
    if [ $? -eq 0 ]; then
        log_msg "HTTP CGI 服务重载成功"
        log_msg "${APP_NAME} 已启动（CGI 模式）"
        return 0
    else
        log_msg "ERROR: HTTP CGI 服务重载失败"
        return 1
    fi
}

# 停止应用（纯 CGI 模式）
stop_process() {
    log_msg "正在停止 ${APP_NAME}（纯 CGI 模式）..."
    
    # 纯 CGI 应用不需要停止进程
    # CGI 脚本由 Web 服务器按需调用，无需手动停止
    log_msg "${APP_NAME} 已停止（CGI 模式）"
    
    return 0
}

# 检查应用状态
status() {
    # 纯 CGI 应用没有持续运行的进程
    # 只要应用已安装，就认为是"运行"状态
    # CGI 脚本由 Web 服务器按需调用
    return 0
}

case $1 in
start)
    # run start command. exit 0 if success, exit 1 if failed
    start_process
    ;;
stop)
    # run stop command. exit 0 if success, exit 1 if failed
    stop_process
    ;;
status)
    # check application status command. exit 0 if running, exit 3 if not running
    if status; then 
        exit 0
    else 
        exit 3
    fi
    ;;
*)
    exit 1
    ;;
esac
